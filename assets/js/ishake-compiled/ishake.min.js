//     Zepto.js
//     (c) 2010-2012 Thomas Fuchs
//     Zepto.js may be freely distributed under the MIT license.
(function(a){String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===a&&(Array.prototype.reduce=function(b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0,e=0,f;if(typeof b!="function")throw new TypeError;if(d==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)f=arguments[1];else do{if(e in c){f=c[e++];break}if(++e>=d)throw new TypeError}while(!0);while(e<d)e in c&&(f=b.call(a,f,c[e],e,c)),e++;return f})})();var Zepto=function(){function a(a){return P.call(a)=="[object Function]"}function b(a){return a instanceof Object}function c(a){var b,c;if(P.call(a)!=="[object Object]")return!1;c=typeof a.constructor=="function"&&a.constructor.prototype;if(!c||!hasOwnProperty.call(c,"isPrototypeOf"))return!1;for(b in a);return b===u||hasOwnProperty.call(a,b)}function d(a){return a instanceof Array}function e(a){return typeof a.length=="number"}function f(a){return a.filter(function(a){return a!==u&&a!==null})}function g(a){return a.length>0?[].concat.apply([],a):a}function h(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function i(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function j(a){return a.filter(function(a,b,c){return c.indexOf(a)==b})}function k(a){return a in C?C[a]:C[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function l(a,b){return typeof b=="number"&&!E[i(a)]?b+"px":b}function m(a){var b,c;return B[a]||(b=A.createElement(a),A.body.appendChild(b),c=D(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),c=="none"&&(c="block"),B[a]=c),B[a]}function n(a,b){b===u&&(b=F.test(a)&&RegExp.$1),b in K||(b="*");var c=K[b];return c.innerHTML=""+a,z.call(c.childNodes)}function o(a,b){return a=a||y,a.__proto__=o.prototype,a.selector=b||"",a}function p(b,e){if(!b)return o();if(e!==u)return p(e).find(b);if(a(b))return p(A).ready(b);if(b instanceof o)return b;var g;return d(b)?g=f(b):c(b)?(g=[p.extend({},b)],b=null):G.indexOf(b.nodeType)>=0||b===window?(g=[b],b=null):F.test(b)?(g=n(b.trim(),RegExp.$1),b=null):b.nodeType&&b.nodeType==3?g=[b]:g=w(A,b),o(g,b)}function q(a,b){return b===u?p(a):p(a).filter(b)}function r(b,c,d,e){return a(c)?c.call(b,d,e):c}function s(a,b,c){var d=a%2?b:b.parentNode;d&&d.insertBefore(c,a?a==1?d.firstChild:a==2?b:null:b.nextSibling)}function t(a,b){b(a);for(var c in a.childNodes)t(a.childNodes[c],b)}var u,v,w,x,y=[],z=y.slice,A=window.document,B={},C={},D=A.defaultView.getComputedStyle,E={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},F=/^\s*<(\w+)[^>]*>/,G=[1,9,11],H=["after","prepend","before","append"],I=A.createElement("table"),J=A.createElement("tr"),K={tr:A.createElement("tbody"),tbody:I,thead:I,tfoot:I,td:J,th:J,"*":A.createElement("div")},L=/complete|loaded|interactive/,M=/^\.([\w-]+)$/,N=/^#([\w-]+)$/,O=/^[\w-]+$/,P={}.toString;return p.extend=function(a){return z.call(arguments,1).forEach(function(b){for(v in b)b[v]!==u&&(a[v]=b[v])}),a},p.qsa=w=function(a,b){var c;return a===A&&N.test(b)?(c=a.getElementById(RegExp.$1))?[c]:y:a.nodeType!==1&&a.nodeType!==9?y:z.call(M.test(b)?a.getElementsByClassName(RegExp.$1):O.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b))},p.isFunction=a,p.isObject=b,p.isArray=d,p.isPlainObject=c,p.inArray=function(a,b,c){return y.indexOf.call(b,a,c)},p.map=function(a,b){var c,d=[],f,h;if(e(a))for(f=0;f<a.length;f++)c=b(a[f],f),c!=null&&d.push(c);else for(h in a)c=b(a[h],h),c!=null&&d.push(c);return g(d)},p.each=function(a,b){var c,d;if(e(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},p.fn={forEach:y.forEach,reduce:y.reduce,push:y.push,indexOf:y.indexOf,concat:y.concat,map:function(a){return p.map(this,function(b,c){return a.call(b,c,b)})},slice:function(){return p(z.apply(this,arguments))},ready:function(a){return L.test(A.readyState)?a(p):A.addEventListener("DOMContentLoaded",function(){a(p)},!1),this},get:function(a){return a===u?z.call(this):this[a]},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(a){return this.forEach(function(b,c){a.call(b,c,b)}),this},filter:function(a){return p([].filter.call(this,function(b){return b.parentNode&&w(b.parentNode,a).indexOf(b)>=0}))},add:function(a,b){return p(j(this.concat(p(a,b))))},is:function(a){return this.length>0&&p(this[0]).filter(a).length>0},not:function(b){var c=[];if(a(b)&&b.call!==u)this.each(function(a){b.call(this,a)||c.push(this)});else{var d=typeof b=="string"?this.filter(b):e(b)&&a(b.item)?z.call(b):p(b);this.forEach(function(a){d.indexOf(a)<0&&c.push(a)})}return p(c)},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!b(a)?a:p(a)},last:function(){var a=this[this.length-1];return a&&!b(a)?a:p(a)},find:function(a){var b;return this.length==1?b=w(this[0],a):b=this.map(function(){return w(this,a)}),p(b)},closest:function(a,b){var c=this[0],d=w(b||A,a);d.length||(c=null);while(c&&d.indexOf(c)<0)c=c!==b&&c!==A&&c.parentNode;return p(c)},parents:function(a){var b=[],c=this;while(c.length>0)c=p.map(c,function(a){if((a=a.parentNode)&&a!==A&&b.indexOf(a)<0)return b.push(a),a});return q(b,a)},parent:function(a){return q(j(this.pluck("parentNode")),a)},children:function(a){return q(this.map(function(){return z.call(this.children)}),a)},siblings:function(a){return q(this.map(function(a,b){return z.call(b.parentNode.children).filter(function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return this.map(function(){return this[a]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),D(this,"").getPropertyValue("display")=="none"&&(this.style.display=m(this.nodeName))})},replaceWith:function(a){return this.each(function(){p(this).before(a).remove()})},wrap:function(a){return this.each(function(){p(this).wrapAll(p(a)[0].cloneNode(!1))})},wrapAll:function(a){return this[0]&&(p(this[0]).before(a=p(a)),a.append(this)),this},unwrap:function(){return this.parent().each(function(){p(this).replaceWith(p(this).children())}),this},hide:function(){return this.css("display","none")},toggle:function(a){return(a===u?this.css("display")=="none":a)?this.show():this.hide()},prev:function(){return p(this.pluck("previousElementSibling"))},next:function(){return p(this.pluck("nextElementSibling"))},html:function(a){return a===u?this.length>0?this[0].innerHTML:null:this.each(function(b){var c=this.innerHTML;p(this).empty().append(r(this,a,b,c))})},text:function(a){return a===u?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=a})},attr:function(a,c){var d;return typeof a=="string"&&c===u?this.length==0?u:a=="value"&&this[0].nodeName=="INPUT"?this.val():!(d=this[0].getAttribute(a))&&a in this[0]?this[0][a]:d:this.each(function(d){if(b(a))for(v in a)this.setAttribute(v,a[v]);else this.setAttribute(a,r(this,c,d,this.getAttribute(a)))})},removeAttr:function(a){return this.each(function(){this.removeAttribute(a)})},data:function(a,b){return this.attr("data-"+a,b)},val:function(a){return a===u?this.length>0?this[0].value:u:this.each(function(b){this.value=r(this,a,b,this.value)})},offset:function(){if(this.length==0)return null;var a=this[0].getBoundingClientRect();return{left:a.left+window.pageXOffset,top:a.top+window.pageYOffset,width:a.width,height:a.height}},css:function(a,b){if(b===u&&typeof a=="string")return this.length==0?u:this[0].style[h(a)]||D(this[0],"").getPropertyValue(a);var c="";for(v in a)c+=i(v)+":"+l(v,a[v])+";";return typeof a=="string"&&(c=i(a)+":"+l(a,b)),this.each(function(){this.style.cssText+=";"+c})},index:function(a){return a?this.indexOf(p(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return this.length<1?!1:k(a).test(this[0].className)},addClass:function(a){return this.each(function(b){x=[];var c=this.className,d=r(this,a,b,c);d.split(/\s+/g).forEach(function(a){p(this).hasClass(a)||x.push(a)},this),x.length&&(this.className+=(c?" ":"")+x.join(" "))})},removeClass:function(a){return this.each(function(b){if(a===u)return this.className="";x=this.className,r(this,a,b,x).split(/\s+/g).forEach(function(a){x=x.replace(k(a)," ")}),this.className=x.trim()})},toggleClass:function(a,b){return this.each(function(c){var d=r(this,a,c,this.className);(b===u?!p(this).hasClass(d):b)?p(this).addClass(d):p(this).removeClass(d)})}},["width","height"].forEach(function(a){p.fn[a]=function(b){var c,d=a.replace(/./,function(a){return a[0].toUpperCase()});return b===u?this[0]==window?window["inner"+d]:this[0]==A?A.documentElement["offset"+d]:(c=this.offset())&&c[a]:this.each(function(c){var d=p(this);d.css(a,r(this,b,c,d[a]()))})}}),H.forEach(function(a,c){p.fn[a]=function(a){var d=b(a)?a:n(a);if(!("length"in d)||d.nodeType)d=[d];if(d.length<1)return this;var e=this.length,f=e>1,g=c<2;return this.each(function(a,b){for(var h=0;h<d.length;h++){var i=d[g?d.length-h-1:h];t(i,function(a){a.nodeName!=null&&a.nodeName.toUpperCase()==="SCRIPT"&&(!a.type||a.type==="text/javascript")&&window.eval.call(window,a.innerHTML)}),f&&a<e-1&&(i=i.cloneNode(!0)),s(c,b,i)}})},p.fn[c%2?a+"To":"insert"+(c?"Before":"After")]=function(b){return p(b)[a](this),this}}),o.prototype=p.fn,p}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(a){function b(a){return a._zid||(a._zid=m++)}function c(a,c,f,g){c=d(c);if(c.ns)var h=e(c.ns);return(l[b(a)]||[]).filter(function(a){return a&&(!c.e||a.e==c.e)&&(!c.ns||h.test(a.ns))&&(!f||a.fn==f)&&(!g||a.sel==g)})}function d(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function e(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function f(b,c,d){a.isObject(b)?a.each(b,d):b.split(/\s/).forEach(function(a){d(a,c)})}function g(c,e,g,h,i,j){j=!!j;var k=b(c),m=l[k]||(l[k]=[]);f(e,g,function(b,e){var f=i&&i(e,b),g=f||e,k=function(a){var b=g.apply(c,[a].concat(a.data));return b===!1&&a.preventDefault(),b},l=a.extend(d(b),{fn:e,proxy:k,sel:h,del:f,i:m.length});m.push(l),c.addEventListener(l.e,k,j)})}function h(a,d,e,g){var h=b(a);f(d||"",e,function(b,d){c(a,b,d,g).forEach(function(b){delete l[h][b.i],a.removeEventListener(b.e,b.proxy,!1)})})}function i(b){var c=a.extend({originalEvent:b},b);return a.each(q,function(a,d){c[a]=function(){return this[d]=o,b[a].apply(b,arguments)},c[d]=p}),c}function j(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0,b.call(this)}}}var k=a.qsa,l={},m=1,n={};n.click=n.mousedown=n.mouseup=n.mousemove="MouseEvents",a.event={add:g,remove:h},a.fn.bind=function(a,b){return this.each(function(){g(this,a,b)})},a.fn.unbind=function(a,b){return this.each(function(){h(this,a,b)})},a.fn.one=function(a,b){return this.each(function(c,d){g(this,a,b,null,function(a,b){return function(){var c=a.apply(d,arguments);return h(d,b,a),c}})})};var o=function(){return!0},p=function(){return!1},q={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(b,c,d){var e=!1;if(c=="blur"||c=="focus")a.iswebkit?c=c=="blur"?"focusout":c=="focus"?"focusin":c:e=!0;return this.each(function(f,h){g(h,c,d,b,function(c){return function(d){var e,f=a(d.target).closest(b,h).get(0);if(f)return e=a.extend(i(d),{currentTarget:f,liveFired:h}),c.apply(f,[e].concat([].slice.call(arguments,1)))}},e)})},a.fn.undelegate=function(a,b,c){return this.each(function(){h(this,b,c,a)})},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,d){return c===undefined||a.isFunction(c)?this.bind(b,c):this.delegate(c,b,d)},a.fn.off=function(b,c,d){return c===undefined||a.isFunction(c)?this.unbind(b,c):this.undelegate(c,b,d)},a.fn.trigger=function(b,c){return typeof b=="string"&&(b=a.Event(b)),j(b),b.data=c,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(b)})},a.fn.triggerHandler=function(b,d){var e,f;return this.each(function(g,h){e=i(typeof b=="string"?a.Event(b):b),e.data=d,e.target=h,a.each(c(h,b.type||b),function(a,b){f=b.proxy(e);if(e.isImmediatePropagationStopped())return!1})}),f},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){if(a)this.bind(b,a);else if(this.length)try{this.get(0)[b]()}catch(c){}return this}}),a.Event=function(a,b){var c=document.createEvent(n[a]||"Events"),d=!0;if(b)for(var e in b)e=="bubbles"?d=!!b[e]:c[e]=b[e];return c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null),c}}(Zepto),function(a){function b(a){var b=this.os={},c=this.browser={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/(Android)\s+([\d.]+)/),f=a.match(/(iPad).*OS\s([\d_]+)/),g=!f&&a.match(/(iPhone\sOS)\s([\d_]+)/),h=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),i=h&&a.match(/TouchPad/),j=a.match(/(BlackBerry).*Version\/([\d.]+)/);if(c.webkit=!!d)c.version=d[1];e&&(b.android=!0,b.version=e[2]),g&&(b.ios=b.iphone=!0,b.version=g[2].replace(/_/g,".")),f&&(b.ios=b.ipad=!0,b.version=f[2].replace(/_/g,".")),h&&(b.webos=!0,b.version=h[2]),i&&(b.touchpad=!0),j&&(b.blackberry=!0,b.version=j[2])}b.call(a,navigator.userAgent),a.__detect=b}(Zepto),function(a,b){function c(a){return a.toLowerCase()}function d(a){return f?f+a:c(a)}var e="",f,g,h,i={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},j=window.document,k=j.createElement("div"),l=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;a.each(i,function(a,d){if(k.style[a+"TransitionProperty"]!==b)return e="-"+c(a)+"-",f=d,!1}),a.fx={off:f===b&&k.style.transitionProperty===b,cssPrefix:e,transitionEnd:d("TransitionEnd"),animationEnd:d("AnimationEnd")},a.fn.animate=function(b,c,d,e){return a.isObject(c)&&(d=c.easing,e=c.complete,c=c.duration),c&&(c/=1e3),this.anim(b,c,d,e)},a.fn.anim=function(c,d,f,g){var h,i={},j,k=this,m,n=a.fx.transitionEnd;d===b&&(d=.4),a.fx.off&&(d=0);if(typeof c=="string")i[e+"animation-name"]=c,i[e+"animation-duration"]=d+"s",n=a.fx.animationEnd;else{for(j in c)l.test(j)?(h||(h=[]),h.push(j+"("+c[j]+")")):i[j]=c[j];h&&(i[e+"transform"]=h.join(" ")),a.fx.off||(i[e+"transition"]="all "+d+"s "+(f||""))}return m=function(b){if(typeof b!="undefined"){if(b.target!==b.currentTarget)return;a(b.target).unbind(n,arguments.callee)}var c={};c[e+"transition"]=c[e+"animation-name"]="none",a(this).css(c),g&&g.call(this)},d>0&&this.bind(n,m),setTimeout(function(){k.css(i),d<=0&&setTimeout(function(){k.each(function(){m.call(this)})},0)},0),this},k=null}(Zepto),function(a){function b(b,c,d){var e=a.Event(c);return a(b).trigger(e,d),!e.defaultPrevented}function c(a,c,d,e){if(a.global)return b(c||n,d,e)}function d(b){b.global&&a.active++===0&&c(b,null,"ajaxStart")}function e(b){b.global&&!--a.active&&c(b,null,"ajaxStop")}function f(a,b){var d=b.context;if(b.beforeSend.call(d,a,b)===!1||c(b,d,"ajaxBeforeSend",[a,b])===!1)return!1;c(b,d,"ajaxSend",[a,b])}function g(a,b,d){var e=d.context,f="success";d.success.call(e,a,f,b),c(d,e,"ajaxSuccess",[b,d,a]),i(f,b,d)}function h(a,b,d,e){var f=e.context;e.error.call(f,d,b,a),c(e,f,"ajaxError",[d,e,a]),i(b,d,e)}function i(a,b,d){var f=d.context;d.complete.call(f,b,a),c(d,f,"ajaxComplete",[b,d]),e(d)}function j(){}function k(b,c,d,e){var f=a.isArray(c);a.each(c,function(c,g){e&&(c=d?e:e+"["+(f?"":c)+"]"),!e&&f?b.add(g.name,g.value):(d?a.isArray(g):m(g))?k(b,g,d,c):b.add(c,g)})}var l=0,m=a.isObject,n=window.document,o,p,q=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;a.active=0,a.ajaxJSONP=function(b){var c="jsonp"+ ++l,d=n.createElement("script"),e=function(){a(d).remove(),c in window&&(window[c]=j),i("abort",f,b)},f={abort:e},h;return b.error&&(d.onerror=function(){f.abort(),b.error()}),window[c]=function(e){clearTimeout(h),a(d).remove(),delete window[c],g(e,f,b)},d.src=b.url.replace(/=\?/,"="+c),a("head").append(d),b.timeout>0&&(h=setTimeout(function(){f.abort(),i("timeout",f,b)},b.timeout)),f},a.ajaxSettings={type:"GET",beforeSend:j,success:j,error:j,complete:j,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0},a.ajax=function(b){var c=a.extend({},b||{});for(o in a.ajaxSettings)c[o]===undefined&&(c[o]=a.ajaxSettings[o]);d(c),c.crossDomain||(c.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(c.url)&&RegExp.$2!=window.location.host);if(/=\?/.test(c.url))return a.ajaxJSONP(c);c.url||(c.url=window.location.toString()),c.data&&!c.contentType&&(c.contentType="application/x-www-form-urlencoded"),m(c.data)&&(c.data=a.param(c.data));if(c.type.match(/get/i)&&c.data){var e=c.data;c.url.match(/\?.*=/)?e="&"+e:e[0]!="?"&&(e="?"+e),c.url+=e}var i=c.accepts[c.dataType],k={},l=/^([\w-]+:)\/\//.test(c.url)?RegExp.$1:window.location.protocol,n=a.ajaxSettings.xhr(),q;c.crossDomain||(k["X-Requested-With"]="XMLHttpRequest"),i&&(k.Accept=i),c.headers=a.extend(k,c.headers||{}),n.onreadystatechange=function(){if(n.readyState==4){clearTimeout(q);var a,b=!1;if(n.status>=200&&n.status<300||n.status==0&&l=="file:"){if(i=="application/json"&&!/^\s*$/.test(n.responseText))try{a=JSON.parse(n.responseText)}catch(d){b=d}else a=n.responseText;b?h(b,"parsererror",n,c):g(a,n,c)}else h(null,"error",n,c)}};var r="async"in c?c.async:!0;n.open(c.type,c.url,r),c.contentType&&(c.headers["Content-Type"]=c.contentType);for(p in c.headers)n.setRequestHeader(p,c.headers[p]);return f(n,c)===!1?(n.abort(),!1):(c.timeout>0&&(q=setTimeout(function(){n.onreadystatechange=j,n.abort(),h(null,"timeout",n,c)},c.timeout)),n.send(c.data),n)},a.get=function(b,c){return a.ajax({url:b,success:c})},a.post=function(b,c,d,e){return a.isFunction(c)&&(e=e||d,d=c,c=null),a.ajax({type:"POST",url:b,data:c,success:d,dataType:e})},a.getJSON=function(b,c){return a.ajax({url:b,success:c,dataType:"json"})},a.fn.load=function(b,c){if(!this.length)return this;var d=this,e=b.split(/\s/),f;return e.length>1&&(b=e[0],f=e[1]),a.get(b,function(b){d.html(f?a(n.createElement("div")).html(b.replace(q,"")).find(f).html():b),c&&c.call(d)}),this};var r=encodeURIComponent;a.param=function(a,b){var c=[];return c.add=function(a,b){this.push(r(a)+"="+r(b))},k(c,a,b),c.join("&").replace("%20","+")}}(Zepto),function(a){a.fn.serializeArray=function(){var b=[],c;return a(Array.prototype.slice.call(this.get(0).elements)).each(function(){c=a(this);var d=c.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&d!="submit"&&d!="reset"&&d!="button"&&(d!="radio"&&d!="checkbox"||this.checked)&&b.push({name:c.attr("name"),value:c.val()})}),b},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(a){function b(a){return"tagName"in a?a:a.parentNode}function c(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"Left":"Right":c-d>0?"Up":"Down"}function d(){e.last&&Date.now()-e.last>=g&&(e.el.trigger("longTap"),e={})}var e={},f,g=750;a(document).ready(function(){a(document.body).bind("touchstart",function(c){var h=Date.now(),i=h-(e.last||h);e.el=a(b(c.touches[0].target)),f&&clearTimeout(f),e.x1=c.touches[0].pageX,e.y1=c.touches[0].pageY,i>0&&i<=250&&(e.isDoubleTap=!0),e.last=h,setTimeout(d,g)}).bind("touchmove",function(a){e.x2=a.touches[0].pageX,e.y2=a.touches[0].pageY}).bind("touchend",function(a){e.isDoubleTap?(e.el.trigger("doubleTap"),e={}):e.x2>0||e.y2>0?((Math.abs(e.x1-e.x2)>30||Math.abs(e.y1-e.y2)>30)&&e.el.trigger("swipe")&&e.el.trigger("swipe"+c(e.x1,e.x2,e.y1,e.y2)),e.x1=e.x2=e.y1=e.y2=e.last=0):"last"in e&&(e.el.trigger("tap"),f=setTimeout(function(){f=null,e.el.trigger("singleTap"),e={}},250))}).bind("touchcancel",function(){e={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}})}(Zepto),function(a){function e(a,b){for(var c=0;c<a.length;c+=1)if(b(a[c],c,a)===!1)return}function f(a){var b=[];for(var c=0,d=a.length;c<d;c++)b=b.concat(a[c]);return b}function g(a,b,c){if(!a.length)return c();var d=0;(function e(){b(a[d],function(b){b||b===!1?(c(b),c=function(){}):(d+=1,d===a.length?c():e())})})()}function h(a,b,c){c=a;for(var d in b)if(b.hasOwnProperty(d)){c=b[d](a);if(c!==a)break}return c===a?"([._a-zA-Z0-9-]+)":c}function i(a,b){~a.indexOf("*")&&(a=a.replace(/\*/g,"([_.()!\\ %@&a-zA-Z0-9-]+)"));var c=a.match(/:([^\/]+)/ig),d;if(c){d=c.length;for(var e=0;e<d;e++)a=a.replace(c[e],h(c[e],b))}return a}Array.prototype.filter||(Array.prototype.filter=function(a,b){var c=[],d;for(var e=0,f=this.length;e<f;e++)e in this&&a.call(b,d=this[e],e,this)&&c.push(d);return c}),Array.isArray||(Array.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"});var b=document.location,c={mode:"modern",hash:location.hash,check:function(){var a=location.hash;a!=this.hash&&(this.hash=a,this.onHashChanged())},fire:function(){this.mode==="modern"?window.onhashchange():this.onHashChanged()},init:function(a){function c(){for(var a=0,b=window.Router.listeners.length;a<b;a++)window.Router.listeners[a]()}var b=this;window.Router.listeners||(window.Router.listeners=[]);if("onhashchange"in window&&(document.documentMode===undefined||document.documentMode>7))window.onhashchange=c,this.mode="modern";else{var d=document.createElement("iframe");d.id="state-frame",d.style.display="none",document.body.appendChild(d),this.writeFrame(""),"onpropertychange"in document&&"attachEvent"in document&&document.attachEvent("onpropertychange",function(){event.propertyName==="location"&&b.check()}),window.setInterval(function(){b.check()},50),this.onHashChanged=c,this.mode="legacy"}return window.Router.listeners.push(a),this.mode},destroy:function(a){if(!window.Router||!window.Router.listeners)return;var b=window.Router.listeners;for(var c=b.length-1;c>=0;c--)b[c]===a&&b.splice(c,1)},setHash:function(a){return this.mode==="legacy"&&this.writeFrame(a),location.hash=a[0]==="/"?a:"/"+a,this},writeFrame:function(a){var b=document.getElementById("state-frame"),c=b.contentDocument||b.contentWindow.document;c.open(),c.write("<script>_hash = '"+a+"'; onload = parent.listener.syncHash;<script>"),c.close()},syncHash:function(){var a=this._hash;return a!=location.hash&&(location.hash=a),this},onHashChanged:function(){}},d=a.Router=function(a){if(!(this instanceof d))return new d(a);this.params={},this.routes={},this.methods=["on","once","after","before"],this._methods={},this._insert=this.insert,this.insert=this.insertEx,this.configure(),this.mount(a||{})};d.prototype.init=function(a){var b=this;return this.handler=function(){var a=location.hash.replace(/^#/,"");b.dispatch("on",a)},location.hash===""&&a&&(location.hash=a),location.hash.length>0&&this.handler(),c.init(this.handler),this},d.prototype.explode=function(){var a=location.hash;return a[1]==="/"&&(a=a.slice(1)),a.slice(1,a.length).split("/")},d.prototype.setRoute=function(a,b,d){var e=this.explode();return typeof a=="number"&&typeof b=="string"?e[a]=b:typeof d=="string"?e.splice(a,b,s):e=[a],c.setHash(e.join("/")),e},d.prototype.insertEx=function(a,b,c,d){return a==="once"&&(a="on",c=function(a){var b=!1;return function(){if(b)return;return b=!0,a.apply(this,arguments)}}(c)),this._insert(a,b,c,d)},d.prototype.getState=function(){return this.state},d.prototype.getRoute=function(a){var b=a;if(typeof a=="number")b=this.explode()[a];else if(typeof a=="string"){var c=this.explode();b=c.indexOf(a)}else b=this.explode();return b},d.prototype.destroy=function(){return c.destroy(this.handler),this},d.prototype.configure=function(a){a=a||{};for(var b=0;b<this.methods.length;b++)this._methods[this.methods[b]]=!0;return this.recurse=a.recurse||this.recurse||!1,this.async=a.async||!1,this.delimiter=a.delimiter||"/",this.strict=typeof a.strict=="undefined"?!0:a.strict,this.notfound=a.notfound,this.resource=a.resource,this.every={after:a.after||null,before:a.before||null,on:a.on||null},this},d.prototype.param=function(a,b){a[0]!==":"&&(a=":"+a);var c=new RegExp(a,"g");this.params[a]=function(a){return a.replace(c,b.source||b)}},d.prototype.on=d.prototype.route=function(a,b,c){var d=this;!c&&typeof b=="function"&&(c=b,b=a,a="on"),b.source&&(b=b.source.replace(/\\\//ig,"/"));if(Array.isArray(a))return a.forEach(function(a){d.on(a.toLowerCase(),b,c)});this.insert(a,this.scope.concat(b.split(new RegExp(this.delimiter))),c)},d.prototype.dispatch=function(a,b,c){function h(){d.last=e.after,d.invoke(d.runlist(e),d,c)}var d=this,e=this.traverse(a,b,this.routes,""),f=this._invoked,g;return this._invoked=!0,!e||e.length===0?(this.last=[],typeof this.notfound=="function"&&this.invoke([this.notfound],{method:a,path:b},c),!1):(this.recurse==="forward"&&(e=e.reverse()),g=this.every&&this.every.after?[this.every.after].concat(this.last):[this.last],g&&g.length>0&&f?(this.async?this.invoke(g,this,h):(this.invoke(g,this),h()),!0):(h(),!0))},d.prototype.invoke=function(a,b,c){var d=this;this.async?g(a,function f(c,d){if(Array.isArray(c))return g(c,f,d);typeof c=="function"&&c.apply(b,a.captures.concat(d))},function(){c&&c.apply(b,arguments)}):e(a,function h(c){if(Array.isArray(c))return e(c,h);if(typeof c=="function")return c.apply(b,a.captures||null);typeof c=="string"&&d.resource&&d.resource[c].apply(b,a.captures||null)})},d.prototype.traverse=function(a,b,c,d){var e=[],f,g,h,i,j;if(b===this.delimiter&&c[a])return i=[[c.before,c[a]].filter(Boolean)],i.after=[c.after].filter(Boolean),i.matched=!0,i.captures=[],i;for(var k in c)if(c.hasOwnProperty(k)&&(!this._methods[k]||this._methods[k]&&typeof c[k]=="object"&&!Array.isArray(c[k]))){f=g=d+this.delimiter+k,this.strict||(g+="["+this.delimiter+"]?"),h=b.match(new RegExp("^"+g));if(!h)continue;if(h[0]&&h[0]==b&&c[k][a])return i=[[c[k].before,c[k][a]].filter(Boolean)],i.after=[c[k].after].filter(Boolean),i.matched=!0,i.captures=h.slice(1),this.recurse&&c===this.routes&&(i.push([c.before,c.on].filter(Boolean)),i.after=i.after.concat([c.after].filter(Boolean))),i;i=this.traverse(a,b,c[k],f);if(i.matched)return i.length>0&&(e=e.concat(i)),this.recurse&&(e.push([c[k].before,c[k].on].filter(Boolean)),i.after=i.after.concat([c[k].after].filter(Boolean)),c===this.routes&&(e.push([c.before,c.on].filter(Boolean)),i.after=i.after.concat([c.after].filter(Boolean)))),e.matched=!0,e.captures=i.captures,e.after=i.after,e}return!1},d.prototype.insert=function(a,b,c,d){var e,f,g,h,j;b=b.filter(function(a){return a&&a.length>0}),d=d||this.routes,j=b.shift(),/\:|\*/.test(j)&&!/\\d|\\w/.test(j)&&(j=i(j,this.params));if(b.length>0)return d[j]=d[j]||{},this.insert(a,b,c,d[j]);if(!j&&!b.length&&d===this.routes){e=typeof d[a];switch(e){case"function":d[a]=[d[a],c];return;case"object":d[a].push(c);return;case"undefined":d[a]=c;return}return}f=typeof d[j],g=Array.isArray(d[j]);if(d[j]&&!g&&f=="object"){e=typeof d[j][a];switch(e){case"function":d[j][a]=[d[j][a],c];return;case"object":d[j][a].push(c);return;case"undefined":d[j][a]=c;return}}else if(f=="undefined"){h={},h[a]=c,d[j]=h;return}throw new Error("Invalid route context: "+f)},d.prototype.extend=function(a){var b=this,c=a.length,d;for(d=0;d<c;d++)(function(a){b._methods[a]=!0,b[a]=function(){var c=arguments.length===1?[a,""]:[a];b.on.apply(b,c.concat(Array.prototype.slice.call(arguments)))}})(a[d])},d.prototype.runlist=function(a){var b=this.every&&this.every.before?[this.every.before].concat(f(a)):f(a);return this.every&&this.every.on&&b.push(this.every.on),b.captures=a.captures,b.source=a.source,b},d.prototype.mount=function(a,b){function d(b,d){var e=b,f=b.split(c.delimiter),g=typeof a[b],h=f[0]===""||!c._methods[f[0]],i=h?"on":e;h&&(e=e.slice(c.delimiter.length),f.shift());if(h&&g==="object"&&!Array.isArray(a[b])){d=d.concat(f),c.mount(a[b],d);return}h&&(d=d.concat(e.split(c.delimiter))),c.insert(i,d,a[b])}if(!a||typeof a!="object"||Array.isArray(a))return;var c=this;b=b||[];for(var e in a)a.hasOwnProperty(e)&&d(e,b.slice(0))}}(window),function(a,b){function e(a,e){c.addType(a,function(f,g,h){var i,j,k,l,m=g,n=(new Date).getTime();if(!f){m={},l=[],k=0;try{f=e.length;while(f=e.key(k++))d.test(f)&&(j=JSON.parse(e.getItem(f)),j.expires&&j.expires<=n?l.push(f):m[f.replace(d,"")]=j.data);while(f=l.pop())e.removeItem(f)}catch(o){}return m}f="__amplify__"+f;if(g===b){i=e.getItem(f),j=i?JSON.parse(i):{expires:-1};if(!(j.expires&&j.expires<=n))return j.data;e.removeItem(f)}else if(g===null)e.removeItem(f);else{j=JSON.stringify({data:g,expires:h.expires?n+h.expires:null});try{e.setItem(f,j)}catch(o){c[a]();try{e.setItem(f,j)}catch(o){throw c.error()}}}return m})}var c=a.store=function(a,b,d,e){var e=c.type;return d&&d.type&&d.type in c.types&&(e=d.type),c.types[e](a,b,d||{})};c.types={},c.type=null,c.addType=function(a,b){c.type||(c.type=a),c.types[a]=b,c[a]=function(b,d,e){return e=e||{},e.type=a,c(b,d,e)}},c.error=function(){return"amplify.store quota exceeded"};var d=/^__amplify__/;for(var f in{localStorage:1,sessionStorage:1})try{window[f].getItem&&e(f,window[f])}catch(g){}if(!c.types.localStorage&&window.globalStorage)try{e("globalStorage",window.globalStorage[window.location.hostname]),c.type==="sessionStorage"&&(c.type="globalStorage")}catch(g){}(function(){if(c.types.localStorage)return;var a=document.createElement("div"),d="amplify";a.style.display="none",document.getElementsByTagName("head")[0].appendChild(a);try{a.addBehavior("#default#userdata"),a.load(d)}catch(e){a.parentNode.removeChild(a);return}c.addType("userData",function(e,f,g){a.load(d);var h,i,j,k,l,m=f,n=(new Date).getTime();if(!e){m={},l=[],k=0;while(h=a.XMLDocument.documentElement.attributes[k++])i=JSON.parse(h.value),i.expires&&i.expires<=n?l.push(h.name):m[h.name]=i.data;while(e=l.pop())a.removeAttribute(e);return a.save(d),m}e=e.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-"),e=e.replace(/^-/,"_-");if(f===b){h=a.getAttribute(e),i=h?JSON.parse(h):{expires:-1};if(!(i.expires&&i.expires<=n))return i.data;a.removeAttribute(e)}else f===null?a.removeAttribute(e):(j=a.getAttribute(e),i=JSON.stringify({data:f,expires:g.expires?n+g.expires:null}),a.setAttribute(e,i));try{a.save(d)}catch(o){j===null?a.removeAttribute(e):a.setAttribute(e,j),c.userData();try{a.setAttribute(e,i),a.save(d)}catch(o){throw j===null?a.removeAttribute(e):a.setAttribute(e,j),c.error()}}return m})})(),function(){function e(a){return a===b?b:JSON.parse(JSON.stringify(a))}var a={},d={};c.addType("memory",function(c,f,g){return c?f===b?e(a[c]):(d[c]&&(clearTimeout(d[c]),delete d[c]),f===null?(delete a[c],null):(a[c]=f,g.expires&&(d[c]=setTimeout(function(){delete a[c],delete d[c]},g.expires)),f)):e(a)})}()}(this.amplify=this.amplify||{}),function(a,b){var c=function(a,c){var d=b.documentElement,e=d.matchesSelector||d.mozMatchesSelector||d.webkitMatchesSelector||d.msMatchesSelector;return e.call(a,c)},d=function(a,b){var d=!1;do d=c(a,b);while(!d&&(a=a.parentNode)&&a.ownerDocument);return d?a:!1},e=Math.abs,f=function(){},g={noScroll:!1,activeClass:"tappable-active",onTap:f,onStart:f,onMove:f,onMoveOut:f,onMoveIn:f,onEnd:f,onCancel:f,allowClick:!1,boundMargin:50,noScrollDelay:0,activeClassDelay:0,inactiveClassDelay:0},h="ontouchend"in document,i={start:h?"touchstart":"mousedown",move:h?"touchmove":"mousemove",end:h?"touchend":"mouseup"},j=function(a,c){var d=b.elementFromPoint(a,c);return d.nodeType==3&&(d=d.parentNode),d},k=function(a){var b=a.target;if(b)return b;var c=a.targetTouches[0];return j(c.clientX,c.clientY)},l=function(a){return a.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")},m=function(a,b){if(!b)return;if(a.classList){a.classList.add(b);return}if(l(a.className).indexOf(b)>-1)return;a.className=l(a.className+" "+b)},n=function(a,b){if(!b)return;if(a.classList){a.classList.remove(b);return}a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(?:\\s|$)"),"$1")};a.tappable=
function(a,c){typeof c=="function"&&(c={onTap:c});var e={};for(var f in g)e[f]=c[f]||g[f];var h=e.containerElement||b.body,l,o,p,q,r=!1,s=!1,t=e.activeClass,u=e.activeClassDelay,v,w=e.inactiveClassDelay,x,y=e.noScroll,z=e.noScrollDelay,A,B=e.boundMargin;h.addEventListener(i.start,function(b){var c=d(k(b),a);if(!c)return;u?(clearTimeout(v),v=setTimeout(function(){m(c,t)},u)):m(c,t),w&&clearTimeout(x),l=b.clientX,o=b.clientY;if(!l||!o){var f=b.targetTouches[0];l=f.clientX,o=f.clientY}p=c,r=!1,s=!1,q=y?c.getBoundingClientRect():null,z&&(clearTimeout(A),y=!1,A=setTimeout(function(){y=!0},z)),e.onStart.call(h,b,c)},!1),h.addEventListener(i.move,function(a){if(!p)return;y?a.preventDefault():clearTimeout(v);var b=a.target,c=a.clientX,d=a.clientY;if(!b||!c||!d){var f=a.changedTouches[0];c||(c=f.clientX),d||(d=f.clientY),b||(b=j(c,d))}y?c>q.left-B&&c<q.right+B&&d>q.top-B&&d<q.bottom+B?(s=!1,m(p,t),e.onMoveIn.call(h,a,b)):(s=!0,n(p,t),e.onMoveOut.call(h,a,b)):!r&&Math.abs(d-o)>10&&(r=!0,n(p,t),e.onCancel.call(b,a)),e.onMove.call(h,a,b)},!1),h.addEventListener(i.end,function(a){if(!p)return;clearTimeout(v);if(w){u&&!r&&m(p,t);var b=p;x=setTimeout(function(){n(b,t)},w)}else n(p,t);e.onEnd.call(h,a,p);var c=a.which==3||a.button==2;if(!r&&!s&&!c){var d=p;setTimeout(function(){e.onTap.call(h,a,d)},1)}p=null},!1),h.addEventListener("touchcancel",function(a){if(!p)return;n(p,t),p=null,e.onCancel.call(h,a)},!1),e.allowClick||h.addEventListener("click",function(b){var c=d(b.target,a);c&&b.preventDefault()},!1)}}(window,document),function(){var a=Math,b=function(a){return a>>0},c=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"",d=/android/gi.test(navigator.appVersion),e=/iphone|ipad/gi.test(navigator.appVersion),f=/playbook/gi.test(navigator.appVersion),g=/hp-tablet/gi.test(navigator.appVersion),h="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,i="ontouchstart"in window&&!g,j=c+"Transform"in document.documentElement.style,k=e||f,l=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,17)}}(),m=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),n="onorientationchange"in window?"orientationchange":"resize",o=i?"touchstart":"mousedown",p=i?"touchmove":"mousemove",q=i?"touchend":"mouseup",r=i?"touchcancel":"mouseup",s="translate"+(h?"3d(":"("),t=h?",0)":")",u=function(a,b){var d=this,e=document,f;d.wrapper=typeof a=="object"?a:e.getElementById(a),d.wrapper.style.overflow="hidden",d.scroller=d.wrapper.children[0],d.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null};for(f in b)d.options[f]=b[f];d.x=d.options.x,d.y=d.options.y,d.options.useTransform=j?d.options.useTransform:!1,d.options.hScrollbar=d.options.hScroll&&d.options.hScrollbar,d.options.vScrollbar=d.options.vScroll&&d.options.vScrollbar,d.options.useTransition=k&&d.options.useTransition,d.scroller.style[c+"TransitionProperty"]=d.options.useTransform?"-"+c.toLowerCase()+"-transform":"top left",d.scroller.style[c+"TransitionDuration"]="0",d.scroller.style[c+"TransformOrigin"]="0 0",d.options.useTransition&&(d.scroller.style[c+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)"),d.options.useTransform?d.scroller.style[c+"Transform"]=s+d.x+"px,"+d.y+"px"+t:d.scroller.style.cssText+=";position:absolute;top:"+d.y+"px;left:"+d.x+"px",d.refresh(),d._bind(n,window),d._bind(o),i||d._bind("mouseout",d.wrapper)};u.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,handleEvent:function(a){var b=this;switch(a.type){case o:if(!i&&a.button!==0)return;b._start(a);break;case p:b._move(a);break;case q:case r:b._end(a);break;case n:b._resize();break;case"mouseout":b._mouseout(a);break;case"webkitTransitionEnd":b._transitionEnd(a)}},_resize:function(){this.refresh()},_pos:function(a,d){a=this.hScroll?a:0,d=this.vScroll?d:0,this.options.useTransform?this.scroller.style[c+"Transform"]=s+a+"px,"+d+"px"+t+" scale("+this.scale+")":(a=b(a),d=b(d),this.scroller.style.left=a+"px",this.scroller.style.top=d+"px"),this.x=a,this.y=d},_start:function(a){var b=this,d=i?a.touches[0]:a,e,f,g;if(!b.enabled)return;b.options.onBeforeScrollStart&&b.options.onBeforeScrollStart.call(b,a),b.options.useTransition&&b._transitionTime(0),b.moved=!1,b.animating=!1,b.zoomed=!1,b.distX=0,b.distY=0,b.absDistX=0,b.absDistY=0,b.dirX=0,b.dirY=0;if(b.options.momentum){b.options.useTransform?(e=getComputedStyle(b.scroller,null)[c+"Transform"].replace(/[^0-9-.,]/g,"").split(","),f=e[4]*1,g=e[5]*1):(f=getComputedStyle(b.scroller,null).left.replace(/[^0-9-]/g,"")*1,g=getComputedStyle(b.scroller,null).top.replace(/[^0-9-]/g,"")*1);if(f!=b.x||g!=b.y)b.options.useTransition?b._unbind("webkitTransitionEnd"):m(b.aniTime),b.steps=[],b._pos(f,g)}b.startX=b.x,b.startY=b.y,b.pointX=d.pageX,b.pointY=d.pageY,b.startTime=a.timeStamp||Date.now(),b.options.onScrollStart&&b.options.onScrollStart.call(b,a),b._bind(p),b._bind(q),b._bind(r)},_move:function(b){var c=this,d=i?b.touches[0]:b,e=d.pageX-c.pointX,f=d.pageY-c.pointY,g=c.x+e,h=c.y+f,j=b.timeStamp||Date.now();c.options.onBeforeScrollMove&&c.options.onBeforeScrollMove.call(c,b),c.pointX=d.pageX,c.pointY=d.pageY;if(g>0||g<c.maxScrollX)g=c.options.bounce?c.x+e/2:g>=0||c.maxScrollX>=0?0:c.maxScrollX;if(h>0||h<c.maxScrollY)h=c.options.bounce?c.y+f/2:h>=0||c.maxScrollY>=0?0:c.maxScrollY;c.distX+=e,c.distY+=f,c.absDistX=a.abs(c.distX),c.absDistY=a.abs(c.distY);if(c.absDistX<6&&c.absDistY<6)return;c.options.lockDirection&&(c.absDistX>c.absDistY+5?(h=c.y,f=0):c.absDistY>c.absDistX+5&&(g=c.x,e=0)),c.moved=!0,c._pos(g,h),c.dirX=e>0?-1:e<0?1:0,c.dirY=f>0?-1:f<0?1:0,j-c.startTime>300&&(c.startTime=j,c.startX=c.x,c.startY=c.y),c.options.onScrollMove&&c.options.onScrollMove.call(c,b)},_end:function(c){if(i&&c.touches.length!=0)return;var d=this,e=i?c.changedTouches[0]:c,f,g,h={dist:0,time:0},j={dist:0,time:0},k=(c.timeStamp||Date.now())-d.startTime,l=d.x,m=d.y,n;d._unbind(p),d._unbind(q),d._unbind(r),d.options.onBeforeScrollEnd&&d.options.onBeforeScrollEnd.call(d,c);if(!d.moved){if(i){f=e.target;while(f.nodeType!=1)f=f.parentNode;f.tagName!="SELECT"&&f.tagName!="INPUT"&&f.tagName!="TEXTAREA"&&(g=document.createEvent("MouseEvents"),g.initMouseEvent("click",!0,!0,c.view,1,e.screenX,e.screenY,e.clientX,e.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,0,null),g._fake=!0,f.dispatchEvent(g))}d._resetPos(200),d.options.onTouchEnd&&d.options.onTouchEnd.call(d,c);return}if(k<300&&d.options.momentum){h=l?d._momentum(l-d.startX,k,-d.x,d.scrollerW-d.wrapperW+d.x,d.options.bounce?d.wrapperW:0):h,j=m?d._momentum(m-d.startY,k,-d.y,d.maxScrollY<0?d.scrollerH-d.wrapperH+d.y:0,d.options.bounce?d.wrapperH:0):j,l=d.x+h.dist,m=d.y+j.dist;if(d.x>0&&l>0||d.x<d.maxScrollX&&l<d.maxScrollX)h={dist:0,time:0};if(d.y>0&&m>0||d.y<d.maxScrollY&&m<d.maxScrollY)j={dist:0,time:0}}if(h.dist||j.dist){n=a.max(a.max(h.time,j.time),10),d.scrollTo(b(l),b(m),n),d.options.onTouchEnd&&d.options.onTouchEnd.call(d,c);return}d._resetPos(200),d.options.onTouchEnd&&d.options.onTouchEnd.call(d,c)},_resetPos:function(a){var b=this,c=b.x>=0?0:b.x<b.maxScrollX?b.maxScrollX:b.x,d=b.y>=0||b.maxScrollY>0?0:b.y<b.maxScrollY?b.maxScrollY:b.y;if(c==b.x&&d==b.y){b.moved&&(b.options.onScrollEnd&&b.options.onScrollEnd.call(b),b.moved=!1);return}b.scrollTo(c,d,a||0)},_mouseout:function(a){var b=a.relatedTarget;if(!b){this._end(a);return}while(b=b.parentNode)if(b==this.wrapper)return;this._end(a)},_transitionEnd:function(a){var b=this;if(a.target!=b.scroller)return;b._unbind("webkitTransitionEnd"),b._startAni()},_startAni:function(){var b=this,c=b.x,d=b.y,e=Date.now(),f,g,h;if(b.animating)return;if(!b.steps.length){b._resetPos(400);return}f=b.steps.shift(),f.x==c&&f.y==d&&(f.time=0),b.animating=!0,b.moved=!0;if(b.options.useTransition){b._transitionTime(f.time),b._pos(f.x,f.y),b.animating=!1,f.time?b._bind("webkitTransitionEnd"):b._resetPos(0);return}h=function(){var i=Date.now(),j,k;if(i>=e+f.time){b._pos(f.x,f.y),b.animating=!1,b.options.onAnimationEnd&&b.options.onAnimationEnd.call(b),b._startAni();return}i=(i-e)/f.time-1,g=a.sqrt(1-i*i),j=(f.x-c)*g+c,k=(f.y-d)*g+d,b._pos(j,k),b.animating&&(b.aniTime=l(h))},h()},_transitionTime:function(a){this.scroller.style[c+"TransitionDuration"]=a+"ms"},_momentum:function(c,d,e,f,g){var h=6e-4,i=a.abs(c)/d,j=i*i/(2*h),k=0,l=0;return c>0&&j>e?(l=g/(6/(j/i*h)),e+=l,i=i*e/j,j=e):c<0&&j>f&&(l=g/(6/(j/i*h)),f+=l,i=i*f/j,j=f),j*=c<0?-1:1,k=i/h,{dist:j,time:b(k)}},_offset:function(a){var b=-a.offsetLeft,c=-a.offsetTop;while(a=a.offsetParent)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){var a=this;a.scroller.style[c+"Transform"]="",a._unbind(n,window),a._unbind(o),a._unbind(p),a._unbind(q),a._unbind(r),a._unbind("mouseout",a.wrapper),a.options.useTransition&&a._unbind("webkitTransitionEnd"),a.options.onDestroy&&a.options.onDestroy.call(a)},refresh:function(){var a=this,b;a.wrapperW=a.wrapper.clientWidth,a.wrapperH=a.wrapper.clientHeight,a.scrollerW=a.scroller.offsetWidth,a.scrollerH=a.scroller.offsetHeight,a.maxScrollX=a.wrapperW-a.scrollerW,a.maxScrollY=a.wrapperH-a.scrollerH,a.dirX=0,a.dirY=0,a.hScroll=a.options.hScroll&&a.maxScrollX<0,a.vScroll=a.options.vScroll&&(!a.options.bounceLock&&!a.hScroll||a.scrollerH>a.wrapperH),b=a._offset(a.wrapper),a.wrapperOffsetLeft=-b.left,a.wrapperOffsetTop=-b.top,a.scroller.style[c+"TransitionDuration"]="0",a._resetPos(200)},scrollTo:function(a,b,c,d){var e=this,f=a,g,h;e.stop(),f.length||(f=[{x:a,y:b,time:c,relative:d}]);for(g=0,h=f.length;g<h;g++)f[g].relative&&(f[g].x=e.x-f[g].x,f[g].y=e.y-f[g].y),e.steps.push({x:f[g].x,y:f[g].y,time:f[g].time||0});e._startAni()},scrollToElement:function(b,c){var d=this,e;b=b.nodeType?b:d.scroller.querySelector(b);if(!b)return;e=d._offset(b),e.left+=d.wrapperOffsetLeft,e.top+=d.wrapperOffsetTop,e.left=e.left>0?0:e.left<d.maxScrollX?d.maxScrollX:e.left,e.top=e.top>0?0:e.top<d.maxScrollY?d.maxScrollY:e.top,c=c===undefined?a.max(a.abs(e.left)*2,a.abs(e.top)*2):c,d.scrollTo(e.left,e.top,c)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(p),this._unbind(q),this._unbind(r)},enable:function(){this.enabled=!0},stop:function(){m(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1}},typeof exports!="undefined"?exports.iScroll=u:window.iScroll=u}(),iShake={ui:{},lang:{},view:{},model:{},repository:{},util:{indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;return-1},sortByAlphabet:function(a,b){return a.sort(function(a,c){return a[b]>c[b]?1:a[b]<c[b]?-1:0})}}},iShake.App=function(){function c(c,d){var e=$("#view-"+c);if(!a)$(".view").addClass("hidden"),e.removeClass("hidden");else{if(a.name==c)return;var f=c=="home"||a.name=="home"||c=="homeback"||a.name=="homeback";$.os.android&&(f=!1);if(f)b.flip({to:e,from:a.el,direction:c=="home"||c=="homeback"?"clockwise":"anticlockwise"});else{var g=["home","lists","online","list","listedit","item","login","register"],h=g.indexOf(c)>g.indexOf(a.name)?"rtl":"ltr";b.slide({to:e,from:a.el,direction:h})}}a&&a.unload&&a.unload(),a=new iShake.view[c](c,e,d),app.updateOnlineStatus()}var a,b=null;return{server:"http://ishake-app.com",lang:"en",run:function(){console.log("run forest, run!"),b=new iShake.ui.PageTransition($(document.body)),this.initLanguage(),this.initMenu(),this.initRouting(),this.initTouches()},getMsg:function(a){return a?iShake.lang[this.lang][a]||a:a},initLanguage:function(){var a=["en","de"],b=navigator.language.substr(0,2);this.lang=a.indexOf(b)!=-1?b:"en";var c=this;$("[data-label]").each(function(a,b){b=$(b),b.html(c.getMsg(b.data("label")))})},initMenu:function(){var a="ontouchstart"in window,b=a?"touchstart":"mousedown",c=this,d=$("#menu");$(".menu-button").on(b,function(a){d.addClass("visible");var e=location.hash.replace("#/","");e=e||"home",d.addClass("menu-"+e),c.timerId&&clearTimeout(c.timerId),c.timerId=setTimeout(function(){$(document.body).one(b,function(a){a.preventDefault(),a.stopPropagation(),$(a.target).hasClass("menu-button")||d.removeClass("visible menu-home menu-lists menu-online")})},100)}),$("#menu-li-logout").on(b,function(a){a.preventDefault(),a.stopPropagation(),d.removeClass("visible menu-home menu-lists menu-online"),FB.logout(function(a){}),iShake.repository.user.current(null),iShake.repository.user.listIds([]),app.request("/user/logout",function(){app.updateLoginStatus(),iShake.ui.notify.alert("user.logoutsuccess")})})},initRouting:function(){var a={"/":function(){c("home")},"/lists":function(){c("lists")},"/homeback":{on:function(){c("homeback")}},"/list/(\\d+)":{on:function(a){c("list",a)}},"/listedit/(\\d+)":{on:function(a){c("listedit",a)}},"/online":function(){c("online")},"/register":function(){c("register")},"/login":function(){c("login")},"/item/(\\d+)":{on:function(a){c("item",a)}}},b="/";Router(a).configure({on:function(){},notfound:function(){location.hash="/"}}).init(b)},initTouches:function(){tappable(".header-button, .button, .icon-button",{containerElement:document.body,noScroll:!0,onTap:function(a,b){b.tagName.toLowerCase()=="a"&&b.hash&&(location.hash=b.hash)}}),tappable(".menu-li-a",{containerElement:document.body,noScroll:!0,onStart:function(a,b){location.hash=b.hash}}),tappable(".disclosure",{containerElement:document.body,onTap:function(a,b){b.tagName.toLowerCase()=="a"&&b.hash&&(location.hash=b.hash)}}),tappable(".facebook-login",{containerElement:document.body})},request:function(a,b,c,d,e){if(!navigator.onLine)return;app.setLoading(!e),d=d||{};var f=iShake.repository.user.current(),g=this;d.sessionId=f&&f.sessionId,$.ajax({type:"POST",data:d,url:this.server+a,dataType:"json",success:function(a){app.setLoading(!1),b&&b.call(c,a),g.updateOnlineStatus(!0)},error:function(a,b){app.setLoading(!1),iShake.ui.notify.alert("no-connection",null,"error"),g.updateOnlineStatus(!1)}})},setLoading:function(a){$("#loader").toggleClass("visible",a)},showNoConnection:function(){$("#no-connection-msg").css("display","block")},updateLoginStatus:function(){var a=iShake.repository.user.current();$(document.body).toggleClass("logged",!!a)},updateOnlineStatus:function(a){a=typeof a!="undefined"?a:navigator.onLine,$(document.body).toggleClass("offline",!a),$("#no-connection-msg").css("display","none")},user:function(a){return iShake.repository.user.current()}}},iShake.lang.de={"common.no-connection":"No connection!","common.back":"Back","common.edit":"Edit","common.finish":"Finish","common.delete":"Delete","common.save":"Save","common.shake":"Shake!","common.start":"Start!","common.login":"Login","common.register":"Register","common.error":"Error","menu.iShake":"iShake","menu.mylists":"My lists","menu.onlinelists":"Online listen","menu.logout":"Log out","lists.hd":"My lists","lists.new-list":"Add list...","lists.list-deleted":"Sorry, this list was deleted by user.","online.hd":"Online lists","listedit.public":"This list is public","listedit.name":"Name","list.new-item":"Add item...","item.text":"Text","item.backside":"Backside","item.backside-text":"Text on backside","listedit.confirm-delete-list-hd":"Are you sure?","listedit.confirm-delete-list-bd":"Are you sure that you want to delete this list?","item.confirm-delete-item-hd":"Are you sure?","item.confirm-delete-item-bd":"Are you sure that you want to delete this item?","listedit.list-saved-hd":"Saved","listedit.list-saved-bd":"Your list has been saved.","item.item-saved-hd":"Saved","item.item-saved-bd":"Item has been saved.","registration.username-empty":"Please enter your username.","registration.username-exists":"This username is already taken.","registration.username-alphanum":"Your username may contain only alpha numeric characters (a-z, 0-9).","registration.username-length":"Your username must contain 4-12 characters.","registration.email-empty":"Please enter your e-mail.","registration.email-email":"Not a valid e-mail address.","registration.email-exists":"Username with this e-mail address already exists.","registration.password-empty":"Please enter your password","registration.password-length":"Your password must be at least 6 characters long.","registration.password-repeat":"Passwords do not match.","login.username-empty":"Please enter your username.","login.password-empty":"Please enter your password.","login.username-wrong":"Username or password is incorrect.","user.username":"Username","user.password":"Password","user.password-repeat":"Repeat password","user.email":"E-mail","user.signinwith":"Sign in with","user.logoutsuccess":"You have been successfully logged out."},iShake.lang.en={"common.no-connection":"No connection!","common.back":"Back","common.edit":"Edit","common.finish":"Finish","common.delete":"Delete","common.save":"Save","common.shake":"Shake!","common.start":"Start!","common.login":"Login","common.register":"Register","common.error":"Error","menu.iShake":"iShake","menu.mylists":"My lists","menu.onlinelists":"Online listen","menu.logout":"Log out","lists.hd":"My lists","lists.new-list":"Add list...","lists.list-deleted":"Sorry, this list was deleted by user.","online.hd":"Online lists","listedit.public":"This list is public","listedit.name":"Name","list.new-item":"Add item...","item.text":"Text","item.backside":"Backside","item.backside-text":"Text on backside","listedit.confirm-delete-list-hd":"Are you sure?","listedit.confirm-delete-list-bd":"Are you sure that you want to delete this list?","item.confirm-delete-item-hd":"Are you sure?","item.confirm-delete-item-bd":"Are you sure that you want to delete this item?","listedit.list-saved-hd":"Saved","listedit.list-saved-bd":"Your list has been saved.","item.item-saved-hd":"Saved","item.item-saved-bd":"Item has been saved.","registration.username-empty":"Please enter your username.","registration.username-exists":"This username is already taken.","registration.username-alphanum":"Your username may contain only alpha numeric characters (a-z, 0-9).","registration.username-length":"Your username must contain 4-12 characters.","registration.email-empty":"Please enter your e-mail.","registration.email-email":"Not a valid e-mail address.","registration.email-exists":"Username with this e-mail address already exists.","registration.password-empty":"Please enter your password","registration.password-length":"Your password must be at least 6 characters long.","registration.password-repeat":"Passwords do not match.","login.username-empty":"Please enter your username.","login.password-empty":"Please enter your password.","login.username-wrong":"Username or password is incorrect.","user.username":"Username","user.password":"Password","user.password-repeat":"Repeat password","user.email":"E-mail","user.signinwith":"Sign in with","user.logoutsuccess":"You have been successfully logged out."},iShake.model.Vector=function(a){this.update(a)},iShake.model.Vector.prototype={isShaking:function(a){var b=Math.abs(a.x-this.x),c=Math.abs(a.y-this.y),d=Math.abs(a.y-this.y),e=18;return b>e||c>e||d>e?!0:!1},update:function(a){this.x=a.x,this.y=a.y,this.z=a.z}},iShake.repository.list={lists:amplify.store("lists")||{},currentId_:amplify.store("currentListId")||0,currentId:function(a){return a&&(this.currentId_=a,amplify.store("currentListId",a)),this.currentId_||0},add:function(a){for(var b=0;b<a.length;b++)this.lists[a[b].id]=a[b];amplify.store("lists",this.lists)},create:function(a,b,c){app.request("/list/add",function(a){var d=iShake.repository.user.listIds();d.push(a.list.id),iShake.repository.user.listIds(d),this.add([a.list]),b&&b.call(c,a.list)},this,{name:a})},addItem:function(a,b,c,d){app.request("/list-item/add",function(b){var e=this.lists[a];e&&e.items&&(e.items.push(b.item),amplify.store("lists",this.lists)),c&&c.call(d,b.item)},this,{listId:a,text:b})},all:function(a,b,c){app.request("/list/all",function(c){var d=c.lists;this.add(d),a.call(b,d)},this,c)},get:function(a,b,c,d){d=d||{},this.lists[a]&&this.lists[a].items&&!d.remote?b.call(c,this.lists[a]):app.request("/list/get/id/"+a,function(d){this.lists[a]=d.list,amplify.store("lists",this.lists),b.call(c,d.list)},this,null,d.silent)},item:function(a,b,c){app.request("/list-item/get",function(a){b&&b.call(c,a.item)},this,{id:a})},update:function(a,b,c){app.request("/list/update",function(a){this.lists[a.id]=a,amplify.store("lists",this.lists),typeof b=="function"&&b.call(c,a.list)},this,{id:a.id,name:a.name,isPublic:a.isPublic})},updateItem:function(a,b,c){app.request("/list-item/update",function(a){this.lists[a.list.id]=a.list,amplify.store("lists",this.lists),b&&b.call(c,a.item)},this,{id:a.id,text:a.text,hasBackside:a.hasBackside,backsideText:a.backsideText})},remove:function(a,b,c){delete this.lists[a.id],amplify.store("lists",this.lists);var d=iShake.repository.user.listIds(),e=iShake.util.indexOf(d,a.id);e!=-1&&(d.splice(e,1),iShake.repository.user.listIds(d)),app.request("/list/delete",function(a){typeof b=="function"&&b.call(c)},this,{id:a.id})},removeItem:function(a,b,c){app.request("/list-item/delete",function(a){this.lists[a.list.id]=a.list,amplify.store("lists",this.lists),b&&b.call(c,a.item)},this,{id:a.id})}},iShake.repository.user={user_:null,listIds_:null,current:function(a){return a&&(this.user_=a,amplify.store("user",a)),this.user_||(this.user_=amplify.store("user")),a===null&&(amplify.store("user",null,{expires:0}),this.user_=null),this.user_},listIds:function(a){var b=this.current();if(a){var c=iShake.repository.list.currentId();a.length&&$.inArray(c,a)==-1&&iShake.repository.list.currentId(a[0])}return a&&b?(b.listIds=a,app.request("/user/set-list-ids",null,null,{listIds:a}),amplify.store("user",b)):a&&(this.listIds_=a,amplify.store("listIds",a)),b?this.listIds_=this.current().listIds:this.listIds_=this.listIds_||amplify.store("listIds")||[],this.listIds_},lists:function(a,b){var c=this.listIds(),d=iShake.repository.list;if(!c||c.length==0)c=c||[],d.all(function(d){for(var e=0;e<d.length;e++)c.push(d[e].id);this.listIds(c),a.call(b,d)},this,{startLists:!0});else{var e=[],f;for(var g=0;g<c.length;g++){f=d.lists[c[g]];if(!f){this.refresh(function(){this.lists(a,b)},this);return}e.push(f)}a.call(b,e)}},refresh:function(a,b){app.request("/user/get",function(c){this.current(c.user),iShake.repository.list.add(c.lists),a&&a.call(b)},this)},setFacebook:function(){app.request("/user/facebook-login",function(a){iShake.repository.user.current(a.user),iShake.repository.list.add(a.lists),app.updateLoginStatus()})}},iShake.ui.Form=function(a){this.el=a,a.on("keydown keyup",function(a){var b=$(a.target);b.parent().toggleClass("empty",!b.val())})},iShake.ui.Form.prototype={dispose:function(){this.el.off("keydown keyup"),this.el[0].reset()},setData:function(a){var b=this.el,c;for(var d in a){c=b.find("[name="+d+"]");switch(c.attr("type")){case"checkbox":c[0].checked=!!a[d];break;default:c.val(a[d]),c.parent().toggleClass("empty",!a[d])}}},submit:function(a,b,c){app.setLoading(!0);var d=this.el.serialize();app.request(a,function(a){app.setLoading(!1),a.success?b.call(c,a):iShake.ui.notify.alert(a.errors[0].message,null,"error")},this,d)},val:function(a){var b=this.el.find("[name="+a+"]");switch(b.attr("type")){case"checkbox":return b.attr("checked")?"1":"0";default:return b.val()}}},iShake.ui.Menu=function(a){a.on("click",function(){$("#menu").css("visibility","visible")})},iShake.ui.NewItemInput=function(a,b,c){a.on("keyup keydown",function(b){a.parent().toggleClass("empty",!a.val()),b.keyCode==13&&b.target.blur()}),a.on("change",function(d){a.parent().addClass("loading"),b.call(c,d.target.value)}),this.input=a},iShake.ui.NewItemInput.prototype.reset=function(){this.input.val("");var a=this.input.parent();a.addClass("empty"),a.removeClass("loading")},iShake.ui.notify={alert:function(a,b,c,d){navigator.notification?navigator.notification.alert(app.getMsg(a),b,app.getMsg(c),app.getMsg(d)):alert(app.getMsg(a))},confirm:function(a,b,c,d){navigator.notification?navigator.notification.confirm(app.getMsg(a),b,app.getMsg(c),app.getMsg(d)):confirm(app.getMsg(a))&&b.call()}},iShake.ui.PageTransition=function(){},iShake.ui.PageTransition.prototype={slide:function(a){var b=$(document.body),c=a.to,d=a.from,e=a.direction,f=a.fn,g={rtl:["slide-out-to-left","slide-in-from-right"],ltr:["slide-out-to-right","slide-in-from-left"]},h=g[e],i=function(){b.removeClass("sliding"),d.addClass("hidden"),d.removeClass(h[0]),c.removeClass(h[1]),f&&f.apply()};b.addClass("sliding"),c.removeClass("hidden"),setTimeout(i,350),d.addClass(h[0]),c.addClass(h[1])},flip:function(a){var b=$(document.body),c=a.to,d=a.from,e=a.direction,f=a.fn,g={clockwise:["flip-out-to-left","flip-in-from-left"],anticlockwise:["flip-out-to-right","flip-in-from-right"]},h=g[e],i=function(){c.off("webkitAnimationEnd"),b.removeClass("viewport-flip"),d.addClass("hidden"),c.removeClass("flip"),d.removeClass("flip"),d.removeClass(h[0]),c.removeClass(h[1]),f&&f.apply()};b.addClass("viewport-flip"),c.removeClass("hidden"),d.addClass("flip"),c.addClass("flip"),c.on("webkitAnimationEnd",i),d.addClass(h[0]),c.addClass(h[1])}},iShake.view={init:function(a,b){this.name=a,this.el=b},initScroll:function(){if($.os.android){var a=$(".scroll",this.el);this.scroller=new iScroll(a[0]),this.scroller.refresh()}},disposeScroll:function(){$.os.android&&this.scroller.destroy()}},iShake.view.home=function(a,b){this.init(a,b);var c=iShake.repository.list.currentId();if(!c){location.hash="/lists";return}this.watchId=0,$("#phone").removeClass("animate"),this.resultNode=$("#result"),app.setLoading(!0),$("section",b).removeClass("has-backside"),this.timerId=setTimeout(function(){app.setLoading(!1),app.showNoConnection()},5e3),iShake.repository.list.get(c,this.initMotion,this)},iShake.view.home.prototype={isShaking:!1,initMotion:function(a){clearTimeout(this.timerId),this.el.toggleClass("ready",!0),app.setLoading(!1),navigator.onLine&&iShake.repository.list.get(a.id,function(a){this.currentList=a},this,{remote:!0,silent:!0}),this.currentList=a,this.currentItem=null;var b=this;$(window).on("devicemotion",function(a){b.onDeviceMotion(a.accelerationIncludingGravity)}),$("#phone").addClass("animate");var c=$.os.android?app.getMsg("common.start"):app.getMsg("common.shake");$("#phone-text").html(c),setTimeout(function(){b.el[0].style.webkitTransform="translate(0, 0)"},1e3),setTimeout(function(){$("#phone").removeClass("animate")},16e3);var d=$.os.version?"tap":"click";$("section",this.el).on(d,function(a){!a.target.href&&!$(a.target).hasClass("menu-button")&&b.startShake()}),this.el.on("swipeLeft swipeRight",function(a){a.preventDefault(),b.currentItem&&b.currentItem.hasBackside&&(location.hash="/homeback")})},onDeviceMotion:function(a){if(!this.vector){this.vector=new iShake.model.Vector(a);return}var b=this.vector,c=b.isShaking(a);c==1&&this.startShake(),b.update(a)},random:function(){var a=Math.floor(Math.random()*this.currentList.items.length);return this.currentList.items[a]},setResult:function(a){this.resultNode.html(a.text);var b=(window.innerHeight-this.resultNode[0].offsetHeight)/2-40;this.resultNode.css({top:b+"px"})},startShake:function(){var a=this;$("section",a.el).removeClass("has-backside"),this.resultNode.addClass("shaking"),this.el.toggleClass("ready",!1),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){clearInterval(a.interval),a.interval=0,a.resultNode.removeClass("shaking"),a.currentItem=a.random(),a.setResult(a.currentItem),amplify.store("currentitem",a.currentItem),a.isShaking=!1,$("section",a.el).toggleClass("has-backside",a.currentItem.hasBackside)},3e3),this.isShaking=!0,this.interval||(this.interval=setInterval(function(){a.setResult(a.random())},300))},unload:function(){$("#phone").removeClass("animate"),$("section",this.el).off("tap"),$("section",this.el).off("click"),this.el.off("swipeLeft swipeRight"),$(window).off("devicemotion")}},$.extend(iShake.view.home.prototype,iShake.view),iShake.view.homeback=function(a,b){this.init(a,b);var c=amplify.store("currentitem"),d=$("#backside-text");d.html(c.backsideText.replace(/[\n]/g,"<br />"));var e=(window.innerHeight-d[0].offsetHeight)/2-40;d.css({top:e+"px"});var f=this;$(f.el).on("swipeRight swipeLeft",function(a){location.hash="/home"})},iShake.view.homeback.prototype={unload:function(){}},$.extend(iShake.view.homeback.prototype,iShake.view),iShake.view.item=function(a,b,c){this.init(a,b),this.form=new iShake.ui.Form($("form",b)),this.enableBackText(!1),this.listRepo=iShake.repository.list,this.listRepo.item(c,this.initForm,this)},iShake.view.item.prototype={enableBackText:function(a){$("[name=backside_text]").parent().toggleClass("hidden",!a)},initForm:function(a){this.item=a,this.form.setData({text:a.text,has_backside:a.hasBackside,backside_text:a.backsideText});var b=this;this.enableBackText(a.hasBackside),$("[name=has_backside]",this.el).on("change",function(a){b.enableBackText(a.target.checked)}),$(".header-button-right",this.el).on("click",function(){b.item.name=b.form.val("name"),b.item.hasBackside=b.form.val("has_backside"),b.item.backsideText=b.form.val("backside_text"),b.listRepo.updateItem(b.item,function(a){iShake.ui.notify.alert("item.item-saved-bd",null,"item.item-saved-hd")},b)}),$(".red-button",this.el).on("click",function(a){iShake.ui.notify.confirm("item.confirm-delete-item-hd",function(){b.listRepo.removeItem(b.item,function(){history.back()},b)},"item.confirm-delete-item-bd")})},unload:function(){$(".red-button",this.el).off("click"),this.form.dispose(),$(".header-button-right",this.el).off("click")}},$.extend(iShake.view.item.prototype,iShake.view),iShake.view.list=function(a,b,c){this.init(a,b),$("section",b).html(""),this.listRepo=iShake.repository.list,this.initData(c)},iShake.view.list.prototype={getItem:function(a){var b=this.listData.items;for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null},initData:function(a){this.listRepo.get(a,function(b){if(!b){iShake.ui.notify.alert("list-deleted");var c=iShake.repository.user.listIds(),d=iShake.util.indexOf(c,a);d!=-1&&(c.splice(d,1),iShake.repository.user.listIds(c)),location.hash="#/lists";return}var e=iShake.repository.user.current(),f=e&&e.username==b.username;$(".header-button-right",this.el).toggleClass("hidden",!f),$(".header-button-right",this.el).attr("href","#/listedit/"+a),this.listData=b,this.renderItems()},this)},onNewItem:function(a){this.listRepo.addItem(this.listData.id,a,function(a){this.editor.reset();var b=document.createElement("li");b.innerHTML='<a class="item-content" href="#/item/'+a.id+'">'+a.text+"</a>",$(b).data("id",a.id);var c=$("li.new-item",this.el);c.before(b)},this)},renderItems:function(){var a=[],b=this.listData.items;iShake.util.sortByAlphabet(b,"text"),$("#view-list h1").html(this.listData.name);var c=app.user(),d=c&&c.username==this.listData.username,e;$("section",this.el).html('<ul class="tableview"></ul>');for(var f=0;f<b.length;f++)e=d?'<a class="item-content" href="#/item/'+b[f].id+'">'+b[f].text+"</a>":'<span class="item-content">'+b[f].text+"</span>",a.push(['<li data-id="'+b[f].id+'">',e,"</li>"].join(""));d&&a.push(['<li class="new-item empty">','<span class="item-loader"><span class="spinner"></span></span>','<input type="text" class="list-edit" name="new" value="" />','<span class="new-item-empty">'+app.getMsg("list.new-item")+"</span>","</li>"].join("")),$("section ul",this.el).html(a.join(""));if(d){var g=$("#view-list .new-item input");this.editor=new iShake.ui.NewItemInput(g,this.onNewItem,this)}this.initScroll()},unload:function(){this.disposeScroll()}},$.extend(iShake.view.list.prototype,iShake.view),iShake.view.listedit=function(a,b,c){this.init(a,b),this.form=new iShake.ui.Form($("form",b)),iShake.repository.list.get(c,this.initForm,this)},iShake.view.listedit.prototype={initForm:function(a){this.item=a;var b=this;this.form.setData({name:a.name,is_public:a.isPublic}),$(".header-button-right",this.el).on("click",function(){b.item.name=b.form.val("name"),b.item.isPublic=b.form.val("is_public"),iShake.repository.list.update(b.item,function(a){iShake.ui.notify.alert("listedit.list-saved-bd",null,"listedit.list-saved-hd")},b)}),$(".red-button",this.el).on("click",function(a){iShake.ui.notify
.confirm("listedit.confirm-delete-list-hd",function(){iShake.repository.list.remove(b.item,function(){history.go(-2)},b)},"listedit.confirm-delete-list-bd")})},unload:function(){this.form.dispose(),$(".red-button",this.el).off("click"),$(".header-button-right",this.el).off("click")}},$.extend(iShake.view.listedit.prototype,iShake.view),iShake.view.lists=function(a,b){this.init(a,b),this.listRepo=iShake.repository.list,$("section",b).html(""),$(".header-button-left",this.el).toggleClass("hidden",!iShake.repository.list.currentId()),app.updateLoginStatus(),app.setLoading(!0),this.timerId=setTimeout(function(){app.setLoading(!1),$("#no-connection").css("display","block")},3e3),iShake.repository.user.lists(this.initLists,this)},iShake.view.lists.prototype={initLists:function(a){app.setLoading(!1),clearTimeout(this.timerId),this.listRepo.currentId()||this.listRepo.currentId(a[0].id),this.renderLists(a)},onClick:function(a){var b=$(a.target),c=b.data("id");if(!c)return;a.preventDefault(),this.listRepo.currentId(c),$("#view-lists .selected").removeClass("selected"),b.parent().addClass("selected"),setTimeout(function(){location.hash="/"},500)},onNewList:function(a){this.listRepo.create(a,function(a){var b=document.createElement("li");b.innerHTML='<span data-id="'+a.id+'" class="item-content">'+a.name+"</span>"+'<a href="#/list/'+a.id+'" class="disclosure"></a>';var c=$("li.new-item",this.el);c.before(b),this.editor.reset(),location.hash="#/list/"+a.id},this)},renderLists:function(a){var b=[],c=this,d=this.listRepo.currentId();a.length==0?$("section",this.el).html(app.getMsg("lists.no-lists")):$("section",this.el).html('<ul class="tableview"></ul>'),iShake.util.sortByAlphabet(a,"name");var e=!1;for(var f=0;f<a.length;f++)e=!!iShake.repository.list.lists[a[f].id].items,b.push(['<li class="',a[f].id==d?" selected":"",e?"":" online",'">','<span data-id="'+a[f].id+'" class="item-content">'+a[f].name+"</span>",'<a href="#/list/'+a[f].id+'" class="disclosure online"></a>',"</li>"].join(""));var g=app.user();g&&g.registered&&b.push(['<li class="new-item empty">','<span class="item-loader"><span class="spinner"></span></span>','<input type="text" class="list-edit" name="new" value="" />','<span class="new-item-empty">'+app.getMsg("lists.new-list")+"</span>","</li>"].join("")),$("section ul",this.el).html(b.join("")),$("section li",this.el).on("click",function(a){c.onClick(a)});if(g&&g.registered){var h=$("#view-lists .new-item input");this.editor=new iShake.ui.NewItemInput(h,this.onNewList,this)}this.initScroll()},unload:function(){this.disposeScroll()}},$.extend(iShake.view.lists.prototype,iShake.view),iShake.view.login=function(a,b){function d(a){a.status=="connected"?(location.hash="/lists",iShake.repository.user.setFacebook()):a.status=="unknown"&&(location.hash="/lists",iShake.repository.user.setFacebook())}this.init(a,b),this.form=new iShake.ui.Form($("form",b));var c=this;$(".header-button-right",b).on("click",function(){c.form.submit("/user/login/",function(a){iShake.repository.user.current(a.user),iShake.repository.list.add(a.lists),app.updateLoginStatus(),history.back()},this)}),$(".facebook-login",this.el).on("click",function(){FB.login(d)})},iShake.view.login.prototype={unload:function(){$(".header-button-right",this.el).off("click"),this.form.dispose()}},$.extend(iShake.view.login.prototype,iShake.view),iShake.view.online=function(a,b){this.init(a,b),$("section",b).html(""),this.listRepo=iShake.repository.list,this.listRepo.all(function(a){this.data=a,this.renderItems()},this)},iShake.view.online.prototype={onClick:function(a){var b=$(a.target),c,d=iShake.repository.user.listIds();if(b.hasClass("plus"))b.removeClass("plus"),b.addClass("minus"),d.push(b.data("id")),iShake.repository.user.listIds(d);else if(b.hasClass("minus")){b.addClass("plus"),b.removeClass("minus");var e=b.data("id");c=$.inArray(e,d),d.splice(c,1),iShake.repository.user.listIds(d)}},renderItems:function(){var a=[],b=this.data,c=this,d=iShake.repository.user.listIds();$("section",this.el).html('<ul class="tableview"></ul>');for(var e=0;e<b.length;e++){var f=iShake.util.indexOf(d,b[e].id)!=-1?"minus":"plus";a.push(["<li>",'<a href="#/list/'+b[e].id+'" data-id="'+b[e].id+'" class="item-content">'+b[e].name+"</a>",'<span class="disclosure '+f+'" data-id="'+b[e].id+'"></span>',"</li>"].join(""))}$("section ul",this.el).html(a.join("")),$("section li",this.el).on("click",function(a){c.onClick(a)})},unload:function(){}},$.extend(iShake.view.online.prototype,iShake.view),iShake.view.register=function(a,b){this.init(a,b),this.form=new iShake.ui.Form($("form",b));var c=this;setTimeout(function(){FB.getLoginStatus(function(a){location.hash="/"})},3e3),$(".header-button-right",b).on("click",function(){c.form.submit("/user/register/",function(a){iShake.repository.user.current(a.user),iShake.repository.list.add(a.lists),app.updateLoginStatus(),history.back()},this)}),$(".facebook-login",this.el).on("click",function(){FB.login(function(a){a.status=="connected"&&(location.hash="/lists",iShake.repository.user.setFacebook())})})},iShake.view.register.prototype={unload:function(){$(".header-button-right",this.el).off("click"),this.form.dispose()}},$.extend(iShake.view.register.prototype,iShake.view);
